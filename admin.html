<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xeonix Admin</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:#f4f6f8;
color:#222;
}
header{
background:#111;
color:white;
padding:15px;
text-align:center;
font-weight:bold;
}
.container{
padding:15px;
}
.card{
background:white;
padding:15px;
margin-bottom:15px;
border-radius:8px;
box-shadow:0 2px 8px rgba(0,0,0,0.05);
}
button{
padding:10px 15px;
border:none;
border-radius:6px;
cursor:pointer;
margin:5px 0;
}
.primary{background:#111;color:white;}
.danger{background:#e53935;color:white;}
.info{background:#1976d2;color:white;}
.success{background:#2e7d32;color:white;}
input{
width:100%;
padding:10px;
margin-bottom:10px;
}
table{
width:100%;
border-collapse:collapse;
font-size:14px;
}
th, td{
border:1px solid #ddd;
padding:8px;
text-align:left;
}
th{
background:#eee;
}
.status{
font-weight:bold;
}
.logout-btn{
float:right;
}
</style>
</head>
<body>

<header>Xeonix Admin</header>

<div class="container" id="loginBox">
<div class="card">
<h3>Login Admin</h3>
<input type="password" id="pw" placeholder="Enter password">
<button class="primary" onclick="login()">Login</button>
</div>
</div>

<div class="container" id="dashboard" style="display:none;">

<div class="card">
<h3>Status Device 
<button class="danger logout-btn" onclick="logout()">Logout</button>
</h3>
<div id="statusText">Checking...</div>
</div>

<div class="card">
<h3>Baterai</h3>
<div id="batteryText">Loading...</div>
</div>

<div class="card">
<h3>Kamera</h3>
<button class="info" onclick="goCam()">Buka Kamera</button>
<button class="info" onclick="goGallery()">Buka Galeri</button>
</div>

<div class="card">
<h3>Rekaman GPS</h3>
<button class="primary" onclick="sendCommand('get_location')">Ambil Posisi</button>
<button class="success" onclick="loadLatestGPS()">Tampilkan Posisi Terakhir</button>
</div>

<div class="card">
<h3>Data GPS</h3>
<div id="gpsData">Belum ada data</div>
<button class="danger" onclick="clearGPS()">Hapus Riwayat</button>
</div>

</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC71owbERIUTdALLUeTILc9KTWYuZ5TNqQ",
  authDomain: "xeonix-e8b4d.firebaseapp.com",
  databaseURL: "https://xeonix-e8b4d-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "xeonix-e8b4d",
  storageBucket: "xeonix-e8b4d.firebasestorage.app",
  messagingSenderId: "1069914635197",
  appId: "1:1069914635197:web:69cfb35ca50b05ac5670d4"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const deviceId="device1";

// ðŸ” LOGIN SYSTEM
function login(){
if(document.getElementById("pw").value==="xeonix"){
localStorage.setItem("xeonix_logged","true");
showDashboard();
}else{
alert("Password salah");
}
}

function showDashboard(){
document.getElementById("loginBox").style.display="none";
document.getElementById("dashboard").style.display="block";
}

function logout(){
localStorage.removeItem("xeonix_logged");
location.reload();
}

if(localStorage.getItem("xeonix_logged")==="true"){
showDashboard();
}

// ðŸ“¡ COMMAND
function sendCommand(cmd){
db.ref("devices/"+deviceId+"/command").set(cmd);
}

function goCam(){
window.location.href="cam.html";
}

function goGallery(){
window.location.href="galeri.html";
}

// ðŸ—‘ CLEAR GPS
function clearGPS(){
if(confirm("Hapus semua riwayat GPS?")){
db.ref("devices/"+deviceId+"/gpsHistory").remove();
document.getElementById("gpsData").innerHTML="Riwayat dihapus";
}
}

// ðŸ“ LOAD LATEST GPS
function loadLatestGPS(){
db.ref("devices/"+deviceId+"/gpsHistory").limitToLast(1).once("value",snap=>{
snap.forEach(child=>{
let d=child.val();
document.getElementById("gpsData").innerHTML=`
<table>
<tr><th>Latitude</th><td>${d.lat}</td></tr>
<tr><th>Longitude</th><td>${d.lon}</td></tr>
<tr><th>Akurasi</th><td>${d.accuracy} m</td></tr>
<tr><th>Desa</th><td>${d.desa}</td></tr>
<tr><th>Kecamatan</th><td>${d.kecamatan}</td></tr>
<tr><th>Kabupaten</th><td>${d.kabupaten}</td></tr>
<tr><th>Provinsi</th><td>${d.provinsi}</td></tr>
<tr><th>Waktu</th><td>${new Date(d.time).toLocaleString()}</td></tr>
</table>
`;
});
});
}

// ðŸŸ¢ ONLINE STATUS
db.ref("devices/"+deviceId+"/online").on("value",snap=>{
if(snap.val()){
document.getElementById("statusText").innerHTML="Online";
document.getElementById("statusText").style.color="green";
}else{
document.getElementById("statusText").innerHTML="Offline";
document.getElementById("statusText").style.color="red";
}
});

// ðŸ”‹ BATTERY REALTIME
db.ref("devices/"+deviceId+"/battery").on("value",snap=>{
let b=snap.val();
if(b){
document.getElementById("batteryText").innerHTML=
"ðŸ”‹ "+b.level+"% "+(b.charging ? "âš¡ Charging" : "Not Charging");
}
});
</script>

</body>
</html>